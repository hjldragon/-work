(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2d7f4c1a"],{"33c3":function(t,e,i){},9232:function(t,e,i){"use strict";var a=i("33c3"),n=i.n(a);n.a},"9c50":function(t,e,i){},b5a4:function(t,e,i){"use strict";i.r(e);var a=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"repair-list"},[i("base-header",{attrs:{"head-title":"现场维修"}}),i("base-search",{staticClass:"base-search",on:{getScreenBox:t.getScreenBox}}),i("van-tabs",{on:{change:t.changeTabs},model:{value:t.active,callback:function(e){t.active=e},expression:"active"}},t._l(t.tabList,function(e,a){return i("van-tab",{key:a,attrs:{title:e.title}},[i("van-list",{attrs:{finished:e.finished,"finished-text":"没有更多了"},on:{load:t.onLoad},model:{value:e.loading,callback:function(i){t.$set(e,"loading",i)},expression:"item.loading"}},t._l(e.content,function(e,a){return i("div",{key:a},[i("list-card",{attrs:{activeIndex:t.active,cardInfo:e},on:{goToDeal:function(i){t.goToDeal(e.fault_id)}}})],1)}),0)],1)}),1),i("van-popup",{attrs:{position:t.bottom},model:{value:t.isShowScreenBox,callback:function(e){t.isShowScreenBox=e},expression:"isShowScreenBox"}},[i("van-picker",{attrs:{"show-toolbar":"",columns:t.columns},on:{confirm:t.sortDialogConfirmClick,cancel:t.sortDialogCancelClick}})],1)],1)},n=[],s=(i("a2a8"),i("7fc4")),o=(i("3f87"),i("7496"),i("a6eb")),c=i.n(o),r=i("4b4a"),d=i.n(r),l=(i("eee6"),i("de57")),u=i("3df5"),f=i.n(u),v=i("96d3"),_=i("4a28"),h=i("4ec3"),m=i("a041"),g=i("9975"),b=i("1f43"),p=i("3d4d"),L=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"list-card"},[i("div",{staticClass:"card__info_row"},[i("div",{staticClass:"card__row flex-box main-space"},[i("div",{staticClass:"row__item blod-text"},[t._v(" 设备编号 : "+t._s(t.cardInfo.vendor_num)+" ")]),0==t.activeIndex?i("div",{staticClass:"v-button danger",on:{click:t.goToDeal}},[t._v("去处理")]):t._e(),0!==t.activeIndex?i("div",{staticClass:"v-button disabled"},[t._v("已处理")]):t._e()]),i("div",{staticClass:"card__row flex-box main-space"},[i("div",{staticClass:"row__item"},[t._v(" 地址 : "+t._s(t.cardInfo.address))]),i("div",{staticClass:"row__item"},[t._v(" 设备状态 : "+t._s(t.cardInfo.vendor_status_str)+" ")])]),0==t.activeIndex?i("div",{staticClass:"card__row flex-box main-space"},[i("div",{staticClass:"row__item text-gray"},[t._m(0),i("span",{staticClass:"icon-box"},[t._v(t._s(t._f("numFix")(t.cardInfo.distanceStr||0))+" km")]),i("span",{staticClass:"r-border"}),i("span",{staticClass:"icon-box"},[t._v(t._s(t.cardInfo.timeStr))])]),i("div",{staticClass:"row__item text-gray"},[t._v(" 故障时间 : "+t._s(t.cardInfo.fault_time_str)+" ")])]):t._e(),0!==t.activeIndex?i("div",{staticClass:"card__row clear-fix"},[i("div",{staticClass:"row__item text-gray fr"},[t._v(" 处理时间 : "+t._s(t.cardInfo.fault_time_str)+" ")])]):t._e()])])},x=[function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("span",{staticClass:"icon"},[a("img",{attrs:{src:i("de5b"),alt:""}})])}],S=(i("7378"),{props:{cardInfo:{type:Object,default:function(){return{vendor_id:"12365412345",vender_status:1,address:"创锦一号",distance:1.2,time:5,distanceStr:"",timeStr:"",break_time:"2018-1111 18:00"}}},activeIndex:{type:Number,default:0}},data:function(){return{imgIcon:i("2917"),VendorStatus:m["e"]}},methods:{goToDeal:function(){this.$emit("goToDeal")},openLocation:function(t){_["a"].openLocation(t.lat,t.lng)}}}),C=S,w=(i("9232"),i("25c1")),D=Object(w["a"])(C,L,x,!1,null,"753f6648",null);D.options.__file="listCard.vue";var k=D.exports,I=i("f2de"),B={components:{BaseHeader:b["a"],BaseSearch:p["a"],ListCard:k},data:function(){return{bottom:"bottom",VendorStatus:m["e"],active:0,page_no:1,page_size:99,locationPoint:{lat:22.55329,lng:113.88308},tabList:[{title:"待处理",send_status:0,loading:!1,finished:!0,content:[],vendorPointList:[],promiseList:[],vendorDistanceList:[]},{title:"已处理",send_status:0,loading:!1,finished:!0,content:[],vendorPointList:[],promiseList:[],vendorDistanceList:[]}],vendorName:"",isShowScreenBox:!1,sortValue:1,columns:[{text:"按设备距离从近到远",value:1},{text:"按故障时间从长到短",value:2}]}},computed:Object(l["a"])({},Object(I["c"])({wxSdkConfig:function(t){return t.wxSdkConfig}})),watch:{wxSdkConfig:function(t){t&&this.calcuDistance()}},created:function(){this.getList()},methods:{getList:function(){var t=this,e=0===this.active?1:3,i={get_fault_list:1,shop_id:g["a"].getShopid(),deal_status:e,page_no:this.page_no,page_size:this.page_size};this.vendorName&&(i["vendor_name"]=this.vendorName),Object(h["c"])(i).then(function(e){if(0===e.ret){var i=e.data.fault_list,a=e.data.total;i=i.map(function(e){e.vendor_status_str=t.VendorStatus.toString(e.vendor_status),e.fault_time_str=f()(1e3*e.fault_time).format("YYYY.MM.DD HH:mm");var i="".concat(e.province).concat(e.city).concat(e.area).concat(e.address);return t.tabList[t.active].promiseList.push(v["a"].getPoint(i)),v["a"].getPoint(i).then(function(i){t.tabList[t.active].vendorPointList.push(i),e.point=i}),e}),t.tabList[t.active].content=i,t.tabList[t.active].loading=!1,t.tabList[t.active].refreshing=!1,t.tabList[t.active].content.length===a&&(t.tabList[t.active].finished=!0)}else t.$toast({message:m["f"].toString(e.ret),duration:2e3})})},getLocation:function(){var t=this;return new d.a(function(e){_["a"].getLocation().then(function(i){t.locationPoint=i,e(i)})})},getDistance:function(){var t=this,e="".concat(this.locationPoint.lat,",").concat(this.locationPoint.lng),i=this.tabList[this.active].vendorPointList.map(function(t){return"".concat(t.lat,",").concat(t.lng)}),a=i.join(";");v["a"].getDistance(e,a).then(function(e){t.tabList[t.active].vendorDistanceList=e.elements,t.tabList[t.active].content.map(function(e,i){e.distance=t.tabList[t.active].vendorDistanceList[i].distance,e.duration=t.tabList[t.active].vendorDistanceList[i].duration,t.$set(e,"distanceStr",e.distance/1e3),t.$set(e,"timeStr",t.getDateDiff(e.duration))})})},getDateDiff:function(t){var e,i=60,a=60*i,n=t/a,s=t/i;if(n>=1){var o=c()(s-60*c()(n));e=c()(n)+"小时",o>=1&&(e=e+o+"分钟")}else e=s>=1?c()(s)+"分钟":"1分钟";return e},calcuDistance:function(){var t=this,e=this.getLocation();d.a.all([].concat(Object(s["a"])(this.tabList[this.active].promiseList),[e])).then(function(e){t.getDistance()})},onLoad:function(){},changeTabs:function(){this.tabList[this.active].content=[],this.getList()},getScreenBox:function(){this.isShowScreenBox=!0},sortDialogCancelClick:function(){this.isShowScreenBox=!1},sortDialogConfirmClick:function(t){this.sortValue=t.value,1===this.sortValue?this.tabList[this.active].content.sort(this.distanceSortFuc):this.tabList[this.active].content.sort(this.timeSortFuc),this.isShowScreenBox=!1},distanceSortFuc:function(t,e){return t.distance-e.distance},timeSortFuc:function(t,e){return t.time-e.time},goToDeal:function(t){this.$router.push({path:"/repair/handle",query:{fault_id:t}})}}},P=B,y=(i("d9a9"),Object(w["a"])(P,a,n,!1,null,"6c63e1cb",null));y.options.__file="list.vue";e["default"]=y.exports},d9a9:function(t,e,i){"use strict";var a=i("9c50"),n=i.n(a);n.a}}]);