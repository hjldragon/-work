# 自动售货机管理HTTP协议

该文档为初稿，仅定义HTTP输入输出， 不涉及其他内容

# 一、自动售货机设备管理

## 1.设备列表/新增

### 1.0 设备保存

#### 接口地址
    vendor_save.php
           
#### 输入 POST
``` js
	{
        save_vendor:1,                  // 参数
        vendor_id:"VI1",                // 设备id<<<<传编辑不传新建
        vendor_num: "0001",             // 设备编号
        vendor_model: "0001",           // 设备型号
        aisle_num: 2,                   // 货道数
        sell_goods_type: "0001",        // 售货类型
        ownership: "0001",              // 设备所有权(即可以是店铺的也可以是运营平台的)<<<<<这里暂时先用名称
        vendor_name: "0001",            // 设备名称
        province: "0001",               // 省
        city: "0001",                   // 市
        area: "0001",                   // 区
        address: "0001",                // 地址
        vendor_person: "0001",          // 设备负责人
        person_phone: "0001",           // 负责人手机号
        is_stockout: 1,                 // 是否开启缺货实时通知(1.开,0.关)
        is_fault: 1,                    //是否开启故障实时通知(1.开,0.关)
        vendor_img: "e9b99ee64.jpg",    //设备图片<<<<<<高清图是一张,原型是多张,前端随意保存，多张用数组
        vendor_type: 1,                 //设备类型(1.升降,2.弹簧,3.称重式)
        max_weight: 1,                  // 最大重量(电子秤vendor_type=2)
        error_weight: 1,                 //误差重量(电子秤vendor_type=2)
        production_num:"1213",           //生产编号
	}
```
#### 输出
``` js
	{
		"ret":0,
		"data":{}
	}
```
}
### 1.0.1 设备所有权判断

#### 接口地址
    vendor_save.php
           
#### 输入 POST
``` js
	{
        is_shop:1,            //参数
        ownership:"123",    //故障列表里面获取id

	}
```
#### 输出
``` js
	{
		"ret":0,
		"data":{}
	}
```
### 1.0. 设备所有权判断

#### 接口地址
    vendor_save.php
           
#### 输入 POST
``` js
	{
        is_shop:1,            //参数
        ownership:"123",    //故障列表里面获取id

	}
```
#### 输出
``` js
	{
		"ret":0,
		"data":{}
	}
```
### 1.1 设备列表(含故障) 
 
### 设备二维码地址

http://platform.jzzwlcm.com:8084/php/img_get.php?get_vendor_qrcode=1&vendor_id=VI37
 
#### 接口地址
    vendor_get.php
           
#### 输入 POST
``` js
	{
        get_vendor_list: 1,              //参数
        vendor_status: 1,               //设备状态(1.正常,2.故障,3.缺货,4.断货)
        ownership: "0001",              //设备所有权
        vendor_name: "0001",            //设备名称含编号
        page_size:10,                  
        page_no:1,
	}
#### 输出
``` js
	{
		"ret":0,
		"data":{
		   "vendor_list": [
                    {
                        "vendor_id": "VI36",//同编辑字段一样
                        "vendor_num": null,
                        "vendor_model": "0001",
                        "aisle_num": 2,
                        "sell_goods_type": "0001",
                        "ownership": "0001",
                        "vendor_name": "0001",
                        "province": "0001",
                        "city": "0001",
                        "area": "0001",
                        "address": "0001",
                        "creat_time": "1545127116",
                        "vendor_person": "0001",
                        "person_phone": null,
                        "is_stockout": 1,
                        "is_fault": 1,
                        "vendor_img": [
                            "e9b99ee64.jpg",
                            "e9b99ee64.jpg"
                        ],
                    
                        "vendor_status": 1,// 设备状态(1.正常,2.故障,3.缺货,4.断货)<<<<<<目前没有产品显示改变状态过程
                        "lastmodtime": 1545127116,
                        "delete": 0,
                        "rvendor_num": "0003",
                        "fault_num": 2, ///故障次数，当vendor_status等于2的情况出现（用于故障表）
                        "fault_id": "FD43",//最新故障时间的故障id,在发送通知的时候需要传送给后台
                         "is_inform": 0,  //是否通知(1.通知,0.未通知)
                    },
                    {
                        "vendor_id": "VI37",
                        "vendor_num": null,
                        "vendor_model": "I型",
                        "aisle_num": 8,
                        "sell_goods_type": "123",
                        "ownership": "赛领",
                        "vendor_name": "自助售货机",
                        "province": "内蒙古自治区",
                        "city": "乌兰察布市",
                        "area": "丰镇市",
                        "address": "测试",
                        "creat_time": "1545127127",
                        "vendor_person": "搜索",
                        "person_phone": null,
                        "is_stockout": 0,
                        "is_fault": 1,
                        "vendor_img": [
                            "f3351f138142e107f6020c424b1f9f8f.jpg"
                        ],
             
                        "vendor_status": 1,// 设备状态(1.正常,2.故障,3.缺货,4.断货)
                        "lastmodtime": 1545127127,
                        "delete": 0,
                        "rvendor_num": "011"
                    }
                ],
                "page_all": 1, //总页数
                "page_size": 10,
                "page_no": 1,
                "vendor_date": {//顶部参数
                            "totalt": 10,//设备总数
                            "sell_all": 8,//在线总数
                            "top_all": 2,//离线总数
                            "fal_all": 0//故障总数
                }
		}
	}
```
}

### 1.1.1 缺货设备列表

#### 接口地址
    aisle_get.php
           
#### 输入 POST
``` js
	{
       get_stock_list: 1,    //参数
       shop_id:"SH21",       //店铺端需要的id
       vendor_name:"SH21",   //设备名称和编号搜索
       ownership:"SH21",     //所有权搜索，SH888不能进行模糊搜索
       
	}
```
#### 输出
``` js
	{
		"ret":0,
		"data":{
		"list": [
                    {
                        "vendor_id": "VI107",//id
                        "vendor_name": "测试货道",//名称
                        "address": "测试货道",//地址
                        "stockout_time": 1545892907,//时间
                        "ownership": "赛领科技",//所属权
                        "is_inform": 0//是否通知
                    },
                    {
                       "vendor_id": "VI107",
                       "vendor_name": "测试货道",
                       "address": "测试货道",
                       "goods_name": "可口可乐",//商品名称
                       "stockout_time": 1545892907,
                       "vendor_person": "测试货道",//施工负责人
                        "aisle_id": "AI65",
                        "ownership": "赛领科技",
                        "is_inform": 0
                    }
                ],
                "total": 1,
                "page_size": 10,
                "page_no": 1,
                "data": {
                    "stock_goods": 2,//缺货商品
                    "stock_total": 1,//缺货设备
                    "out_goods": 0//断货商品
                }
            }
	}
```

### 1.2 设备详情

#### 接口地址
    vendor_get.php
           
#### 输入 POST
``` js
	{
       get_vendor_info: 1,    //参数
       vendor_id: "VI37"      //设备id(列表获取)
	}
```
#### 输出
``` js
	{
		"ret":0,
		"data":{
		 "info": {
                    "vendor_id": "VI37",//字段同保存一样
                    "vendor_num": null,
                    "vendor_model": "I型",
                    "aisle_num": 8,//总货道
                    "sell_goods_type": "123",
                    "ownership": "赛领",
                    "vendor_name": "自助售货机",
                    "province": "内蒙古自治区",
                    "city": "乌兰察布市",
                    "area": "丰镇市",
                    "address": "测试",
                    "creat_time": "1545127127",
                    "vendor_person": "搜索",
                    "person_phone": null,
                    "is_stockout": 0,
                    "is_fault": 1,
                    "vendor_img": [
                        "f3351f138142e107f6020c424b1f9f8f.jpg"
                    ],
                    "vendor_qrcode": null,
                    "vendor_status": 1,
                    "sell_status": null,
                    "lastmodtime": 1545127127,
                    "delete": 0,
                    "rvendor_num": "011",
                    "all_use_num": 25,//总容量
                    "goods_all_num": 20,//总商品数
                     "out_aisle_num": 1//缺货货道
                     vendor_type: 1, //设备类型(1.升降,2.弹簧,3.称重式)
                     max_weight: 1,                  // 最大重量(电子秤vendor_type=2)
                     error_weight: 1,                 //误差重量(电子秤vendor_type=2)
                }
		}
	}
```
### 1.2.1 设备详情中的货道列表
 
#### 接口地址
    aisle_get.php
#### 说明

这里和商品详情是同一个接口，只要取下面商品的信息放在列表中即可<<<<<有问题再商量
         
#### 输入 POST
``` js
	{
        get_aisle_list: 1,              //参数
        vendor_id:"VI107",               //设备ID
        "page_size": 10,
        "page_no": 1,
	}
#### 输出
``` js
	{
		"ret":0,
		"data":{
		   "aisle_list": [
                      {
                           "aisle_id": "AI56",//货道id
                           "vendor_id": "VI107",
                           "aisle_name": "1",//编号
                           "aisle_capacity": null,//容量
                           "vendor_goods_id": "VG9",
                           "goods_num": 5,//货道商品存量
                           "is_sale": 1,
                           "aisle_status": 1,//货道状态(1.正常,2.异常)
                           "lastmodtime": 1545631069,
                           "delete": 0,
                           "img": "a5fa865ce8b3f248cb73126d721f89b0.jpg",//商品图片取的第一张
                           "goods_name": "百事可乐",//商品名称
                           "goods_bar_code": "",//商品条码
                            "goods_price": 3   //商品价格
                            "goods_stock": 3   //商品库存
                      },
                      {
                          "aisle_id": "AI65",
                          "vendor_id": "VI107",
                          "aisle_name": "4",
                          "aisle_capacity": null,
                          "vendor_goods_id": null,
                          "goods_num": null,
                          "is_sale": null,
                          "aisle_status": 1,
                          "lastmodtime": 1545623472,
                          "delete": 0
                      },
                  ],
                  "total": 4,
                  "page_size": 10,
                  "page_no": 1
	}
```
}
### 1.2.2 发送补货通知

#### 接口地址
    aisle_save.php
           
#### 输入 POST
``` js
	{
        save_aisle:1,            //参数
        aisle_id:"AI56",    //列表里面获取id

	}
```
#### 输出
``` js
	{
		"ret":0,
		"data":{}
	}
```
### 1.2.3 补货纪录

#### 接口地址
    vendor_record_get.php
           
#### 输入 POST
``` js
	{
        get_list:1,            //参数
        vendor_id:"VI107",    //设备id
        use_name:"132",       //名称/编号
	}
```
#### 输出
``` js
	{
		"ret":0,
		"data":{
		  "list": [
                    {
                        "record_id": "VR9",//补货id
                        "aisle_id": "AI59",
                        "vendor_id": "VI107",
                        "vendor_goods_id": "VG22",
                        "goods_num": 5,
                        "record_time": 1545634397,//补货时间
                        "use_name": "冉总",//补货人呢
                        "lastmodtime": 1545634397,
                        "delete": null
                    }]
		
		}
	}
```
### 1.2.4 货道流水

#### 接口地址
    vendor_get.php
           
#### 输入 POST
``` js
	{
        vendor_aisle_order:1,     //参数
        vendor_id:"VI107",       //设备id
        order_name:"132",       //名称/编号
	}
```
#### 输出
``` js
	{
		"ret":0,
		"data":{
		  "order_list": [
                      {
                          "vendor_order_id": "VO255",//订单id
                          "aisle_id": "AI56", //货道id
                          "vendor_id": "VI107",//设备id
                          "goods_name": "百事可乐",//商品名称
                          "goods_bar_code": "",//条形码
                          "goods_num": 1,//交易数量
                          "aisle_num": 0,//货道剩余数量
                          "pay_time": 1545892907//支付时间
                      },
                      {
                          "vendor_order_id": "VO255",
                          "aisle_id": "AI65",
                          "vendor_id": "VI107",
                          "goods_name": "可口可乐",
                          "goods_bar_code": "123123123",
                          "goods_num": 2,
                          "aisle_num": 0,
                          "pay_time": 1545892907
                      }
                  ]
	}
```
### 1.3 设备改变状态

#### 接口地址
    vendor_save.php
           
#### 输入 POST
``` js
	{
        change_status:1,            //参数
        vendor_id_list:["VI13"],    //设备id
        delete:1,                   //是否删除(0:未删除; 1:已删除)
        sell_status: 1,             // 设备状态(1.正在售货,0.停止售货)
   
	}
```
#### 输出
``` js
	{
		"ret":0,
		"data":{}
	}
```

### 2.0 设备故障发送通知

#### 接口地址
    fault_save.php
           
#### 输入 POST
``` js
	{
        send_fault:1,            //参数
        fault_id:"FD43",    //故障列表里面获取id

	}
```
#### 输出
``` js
	{
		"ret":0,
		"data":{}
	}
```
### 2.1 设备补货发送通知

#### 接口地址
    aisle_save.php
           
#### 输入 POST
``` js
	{
        save_aisle:1,            //参数
        aisle_id:"FD43",        //故障列表里面获取id

	}
```
#### 输出
``` js
	{
		"ret":0,
		"data":{}
	}
```
### 3.0 设备看版图顶部数据

#### 接口地址
    vendor_board.php
           
#### 输入 POST
``` js
	{
        get_top_data:1,            //参数
        shop_id:"SH21",           //店铺id
  

	}
```
#### 输出
``` js
	{
		"ret":0,
		"data":{
		  "total": 12,        // 设备总数
          "normal_total": 10,  // 正常总数<<<<产品没有说明
          "stockout_total": 0,// 缺货总数<<<<<无处理来源
          "deal_total": 7     // 待处理总数<<<<<<无处理来源(临时随意创建的)
		}
	}
```

### 3.1 设备看版图地图数据

#### 接口地址
    vendor_board.php
           
#### 输入 POST
``` js
	{
        get_date_map:1,            //参数
        province: "海南省"         // 搜索身份
         shop_id:"SH21",           //店铺id

	}
```
#### 输出
``` js
	{
		"ret":0,
		"data":{
		  "list": [
                     {
                         "province": "内蒙古自治区",//<<<<省名<<<<<<<<说明，若该省份0台设备是不会显示该省份的
                         "num": 1                 //设备数量
                     },
                     {
                         "province": "重庆市",
                         "num": 1
                     },
                     {
                         "province": "海南省",
                         "num": 2
                     },
                     {
                         "province": "黑龙江省",
                         "num": 2
                     },
                     {
                         "province": "河北省",
                         "num": 1
                     }
                   ]
		}
	}
```
### 3.2 设备中间看板图

#### 接口地址
    vendor_board.php
           
#### 输入 POST
``` js
	{
        get_date_board:1,            //参数
        shop_id:"SH21",           //店铺id
        day:20180101,             //天
        begin_day:20180101,      //开始时间
        end_day:20180102,        //结束时间时间
  

	}
```
#### 输出 //<<<<<<<<<<<<<<<<<<<<占时没有数据，正在造中
``` js
	{
		"ret":0,
		"data":{
	      "list": [],
            "data": {
                "today_money": null,
                "today_num": null,
                "yesday_compare_money": 0,
                "yesday_compare_num": 0,
                "toweek_money": null,
                "toweek_num": null,
                "yesweek_compare_money": 0,
                "yesweek_compare_num": 0,
                "tomoth_money": null,
                "tomoth_num": null,
                "yesmoth_compare_money": 0,
                "yesmoth_compare_num": 0
           
		}
	}
```
### 4.1 订单列表

#### 接口地址
    vendor_order_get.php
           
#### 输入 POST
``` js
	{
        get_order_list: 1,            //参数
        pay_way: 1,                   // 支付方式(1:微信支付, 2:支付宝支付)
        vendor_order_id:"1c",           // 订单id
        vendor_id: "1b",                  // 设备编号id
        shop_id: "1a",                   // 店铺id,平台默认为SH888
        begin_time: 121414,           // 下单开始时间
        end_time: 1412412431,         // 下单开始结束时间
        page_no: 1,                   // 搜索身份
        page_size: 1,                 // 搜索身份
  

	}
```
#### 输出
``` js
	{
		 "ret": 0,
            "msg": null,
            "data": {
                "data": {//顶部数据
                        "today_num": null,//今日交易量
                        "today_money": null,//今日交易金额
                        "tomoth_num": null,//本月交易量
                        "tomoth_money": null//本月交易金额
                    },
                "order_list":[
                                         {
                                             "vendor_order_id": "VO182",//订单id
                                             "customer_id": "CU969",//顾客id
                                             "vendor_id": "VI107",//设备id
                                             "goods_list": [//商品列表
                                                 {
                                                     "vendor_goods_id": "VG9",
                                                     "goods_name": "百事可乐",//商品名称
                                                     "goods_price": 3,//商品单价
                                                     "goods_num": 2,//商品数量
                                                     "aisle_id": ""//货道id
                                                     "aisle_name": null,//货道名称
                                                 },
                                                 {
                                                     "vendor_goods_id": "VG13",
                                                     "goods_name": "可口可乐",
                                                     "goods_price": 3,
                                                     "goods_num": 1,
                                                     "aisle_id": ""
                                                     "aisle_name": null
                                                 }
                                             ],
                                             "shop_id": "SH888",//店铺名称
                                             "order_time": 1545733984,//下单时间
                                             "pay_time": null,//支付时间
                                             "order_fee": 9,//订单金额
                                             "paid_price": null,//实际支付金额
                                             "order_status": 1,//订单状态(1:未支付(待付款),2:已支付(交易完成),3:退款成功,)
                                             "pay_way": 1,// 支付方式(1:微信支付, 2:支付宝支付)
                                             "lastmodtime": 1545733984,
                                             "delete": null
                                         },
                                         {
                                             "vendor_order_id": "VO187",
                                             "customer_id": "CU969",
                                             "vendor_id": "VI107",
                                             "goods_list": [
                                                 {
                                                     "vendor_goods_id": "VG9",
                                                     "goods_name": "百事可乐",
                                                     "goods_price": 3,
                                                     "goods_num": 2,
                                                     "aisle_id": ""
                                                 },
                                                 {
                                                     "vendor_goods_id": "VG13",
                                                     "goods_name": "可口可乐",
                                                     "goods_price": 3,
                                                     "goods_num": 1,
                                                     "aisle_id": ""
                                                 }
                                             ],
                                             "shop_id": "SH888",
                                             "order_time": 1545791290,
                                             "pay_time": null,
                                             "order_fee": 9,
                                             "paid_price": null,
                                             "order_status": 1,
                                             "pay_way": 1,
                                             "lastmodtime": 1545791290,
                                             "delete": null
                                         }
                                     ],
                "total": 2,
                "page_size": 10,
                "page_no": 1
            }
	}
```

### 4.2 订单详情

#### 接口地址
    vendor_order_get.php
           
#### 输入 POST
``` js
	{
            get_order_info: 1,  //参数
            vendor_order_id: "VO182"  //订单id,列表获取

  

	}
```
#### 输出
``` js
	{
		 "ret": 0,
            "msg": null,
            "data": {
                "order_list":[
                           "info": {
                                      "vendor_order_id": "VO182",
                                      "customer_id": "CU969",
                                      "vendor_id": "VI107",
                                      "goods_list": [
                                          {
                                              "vendor_goods_id": "VG9",
                                              "goods_name": "百事可乐",
                                              "goods_price": 3,
                                              "goods_num": 2,
                                              "aisle_id": ""
                                          },
                                          {
                                              "vendor_goods_id": "VG13",
                                              "goods_name": "可口可乐",
                                              "goods_price": 3,
                                              "goods_num": 1,
                                              "aisle_id": ""
                                          }
                                      ],
                                      "shop_id": "SH888",
                                      "order_time": 1545733984,
                                      "pay_time": null,
                                      "order_fee": 9,
                                      "paid_price": null,
                                      "order_status": 1,
                                      "pay_way": 1,
                                      "lastmodtime": 1545733984,
                                      "delete": null
                                  }
         }
	}
```