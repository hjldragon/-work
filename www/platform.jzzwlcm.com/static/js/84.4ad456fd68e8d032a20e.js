webpackJsonp([84],{"/ei4":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s("6ROu"),n=s.n(i),a=s("5aCZ"),l=s("6nXL"),o=s("monS"),c={components:{Tinymce:a.a},data:function(){return{pickerOptions:{disabledDate:function(t){return t.getTime()<Date.now()-864e5}},sendTypeOption:[{label:l.y.toString(l.y.SHOP),value:l.y.SHOP},{label:l.y.toString(l.y.AGENT),value:l.y.AGENT}],sendType:"",msgTitle:"",msgContent:"",msgSengTime:"",sengTimeDialog:!1,newsid:""}},computed:{isShowBtn:function(){return!!(this.sendType&&this.msgTitle&&this.msgContent&&'<p><br data-mce-bogus="1"></p>'!==this.msgContent&&0!==this.msgTitle.replace(/(^\s*)|(\s*$)/,"").length)}},created:function(){this.newsid=this.$route.query.newsid||"",this.newsid&&this.getnews()},methods:{getnews:function(){var t=this,e={sysnews_info:1,news_id:this.newsid};Object(o.c)(e).then(function(e){if(0===e.ret){var s=e.data.info;t.sendType=s.send_type,t.msgTitle=s.title,t.msgContent=s.content}else t.$slnotify({message:l.C.toString(e.ret),duration:1500})})},openSengTimeDialog:function(){this.sengTimeDialog=!0},hideSengTimeDialog:function(){this.sengTimeDialog=!1},closeHandler:function(){this.msgSengTime=""},send:function(t){var e=this;if(!t||this.msgSengTime){var s={news_save:1,send_type:this.sendType,title:this.msgTitle.trim(),content:this.msgContent};this.newsid&&(s.news_id=this.newsid),this.checkData()||(this.msgSengTime&&(s.send_time=parseInt(n()(this.msgSengTime).format("X"))),Object(o.d)(s).then(function(t){0===t.ret?(e.$slnotify({message:"发布成功",duration:1500}),setTimeout(function(){e.$router.push("/message/system")},1500)):t.ret===l.C.NEWS_IS_SEND?e.$slnotify({message:"已发布消息不能编辑",duration:1500}):e.$slnotify({message:l.C.toString(t.ret),duration:1500})}))}else this.$slnotify({message:"请选择发送时间！"})},checkData:function(){var t=!1;this.msgSengTime&&(parseInt(n()(this.msgSengTime).format("x"))<Date.now()&&(t=!0,this.$slnotify({message:"设定的时间已经过期",duration:1500})));return t},cancel:function(){this.$router.push("/message/system")}}},r={render:function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{attrs:{id:"editore-article"}},[s("div",{staticClass:"breadcrumb"},[s("el-breadcrumb",{attrs:{separator:">"}},[s("el-breadcrumb-item",{attrs:{to:{path:"/message/system"}}},[t._v("系统公告")]),t._v(" "),s("el-breadcrumb-item",[t._v("新增系统公告")])],1)],1),t._v(" "),s("div",{staticClass:"title clearfix"},[s("span",[t._v("新增系统公告")]),t._v(" "),s("div",{staticClass:"btn-group fr"},[t.isShowBtn?t._e():s("div",{staticClass:"send-gray-btn"},[t._v("发布")]),t._v(" "),t.isShowBtn?t._e():s("div",{staticClass:"send-time-gray-btn"},[t._v("定时发布")]),t._v(" "),t.isShowBtn?s("div",{staticClass:"send-btn",on:{click:function(e){t.send(!1)}}},[t._v("发布")]):t._e(),t._v(" "),t.isShowBtn?s("div",{staticClass:"send-time-btn",on:{click:t.openSengTimeDialog}},[t._v("定时发布")]):t._e(),t._v(" "),s("div",{staticClass:"cancel-btn",on:{click:t.cancel}},[t._v("取消")])])]),t._v(" "),s("div",{staticClass:"editor-content"},[s("div",{staticClass:"editor-item article-type"},[t._m(0),t._v(" "),s("div",{staticClass:"item-right"},[s("el-select",{attrs:{placeholder:"请选择"},model:{value:t.sendType,callback:function(e){t.sendType=e},expression:"sendType"}},t._l(t.sendTypeOption,function(t){return s("el-option",{key:t.value,attrs:{label:t.label,value:t.value}})}))],1)]),t._v(" "),s("div",{staticClass:"editor-item article-title"},[t._m(1),t._v(" "),s("div",{staticClass:"item-right"},[s("el-input",{model:{value:t.msgTitle,callback:function(e){t.msgTitle=e},expression:"msgTitle"}})],1)]),t._v(" "),s("div",{staticClass:"editor-item article-content"},[t._m(2),t._v(" "),s("div",{staticClass:"item-right"},[s("tinymce",{ref:"editor",attrs:{height:400},model:{value:t.msgContent,callback:function(e){t.msgContent=e},expression:"msgContent"}})],1)])]),t._v(" "),s("el-dialog",{staticClass:"nopadding operate-dialog",attrs:{visible:t.sengTimeDialog,width:"600px",top:"35vh",center:""},on:{"update:visible":function(e){t.sengTimeDialog=e},close:t.closeHandler}},[s("div",{staticClass:"operate-content"},[s("div",{staticClass:"sent-title"},[t._v("定时发布")]),t._v(" "),s("div",{staticClass:"select-time"},[s("span",[t._v("发布时间")]),t._v(" "),s("el-date-picker",{attrs:{type:"datetime","picker-options":t.pickerOptions,placeholder:"选择日期时间"},model:{value:t.msgSengTime,callback:function(e){t.msgSengTime=e},expression:"msgSengTime"}})],1)]),t._v(" "),s("div",{staticClass:"btn-dialog",attrs:{slot:"footer"},slot:"footer"},[s("div",{staticClass:"btn-Dialogok",on:{click:function(e){t.send(!0)}}},[t._v("确定")]),t._v(" "),s("div",{staticClass:"btn-Dialogcancel",on:{click:t.hideSengTimeDialog}},[t._v("取消")])])])],1)},staticRenderFns:[function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"item-left"},[e("span",{staticClass:"sl-must"},[this._v("发送对象")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"item-left"},[e("span",{staticClass:"sl-must"},[this._v("消息标题")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"item-left"},[e("span",{staticClass:"sl-must"},[this._v("消息正文")])])}]};var d=s("C7Lr")(c,r,!1,function(t){s("TRaf"),s("GO0Q")},"data-v-7aa2e616",null);e.default=d.exports},GO0Q:function(t,e){},TRaf:function(t,e){}});